<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:core="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core">

<ui:composition template="/template/template.xhtml">
	<ui:define name="pad">&nbsp;</ui:define>
	<ui:define name="titulo">#{msgs.nome_aplicativo_resumido}</ui:define>
	<ui:define name="titulo_pagina">#{msgs.agendamentos_lotes}</ui:define>
	<ui:define name="conteudo">
		<script type="text/javascript" src="../js/formatadores.js"></script>
		<style type="text/css">
			.coluna{
				width: 55px;
				text-align: right;
			}
		    
			.coluna2{
				width: 85px;
				text-align: right;
			}
			.coluna3{
				width: 65px;
				text-align: right;
			}
		</style>
		
		<h:form id="formGeral">
			<div id="container_conteudo_interno" style="background-color: #FFFFFF;" class="conteudo-principal">
		        <p:blockUI block="formGeral" trigger="tabelaAgendas">  
		        	#{msgs.carregando_msg}<br />  
		        	<p:graphicImage value="../img/icones/ajax-loader.gif"/>  
			    </p:blockUI>
			
				<p:contextMenu for="tabelaAgendas">
					<p:menuitem value="#{msgs.adicionar_lote}" update="painelADD" icon="ui-icon-plusthick"
						actionListener="#{triagemLoteBean.preparaObjetosParaInserirLote()}" oncomplete="dialogoADD.show()" ajax="true"/>
				</p:contextMenu>
				
				<p:dataTable id="tabelaAgendas" widgetVar="tabelaDeAgendas" var="lista" value="#{triagemLoteBean.calendarios}" paginator="true" 
					rows="10" lazy="true" emptyMessage="#{msgs.nenhum_dado_encontrado}" selection="#{triagemLoteBean.calendario}" 
					selectionMode="single" paginatorPosition="top">  
			        
					<p:column headerText="#{msgs.codigo_msg}" sortBy="#{lista.id}" styleClass="coluna3">
			 			#{lista.id}
			        </p:column>
			  
			        <p:column headerText="#{msgs.cliente_msg}">
			 			#{lista.warehouse.cliente.nomeFantasia}
			        </p:column>
			
			        <p:column headerText="#{msgs.warehouse_msg}">
			 			#{lista.warehouse.nomeFantasia}
			        </p:column>
			
			        <p:column headerText="#{msgs.data_msg}" sortBy="#{lista.dataInicial}" styleClass="coluna2">
			        	<h:outputText value="#{lista.dataInicial}">
							<f:convertDateTime pattern="dd/MM/yyyy" type="date" />
						</h:outputText>
			        </p:column>
			        
			        <p:column headerText="#{msgs.hora_msg}" styleClass="coluna2">
	   					<h:outputText value="#{lista.dataInicial}">
							<f:convertDateTime pattern="HH:mm" type="time" />
						</h:outputText>
			        </p:column>
			        
			        <p:column headerText="#{msgs.qtd_msg}" sortBy="#{lista.quantidade}" styleClass="coluna">
						#{lista.quantidade}
			        </p:column>
			        
			        <p:column headerText="#{msgs.lote_msg}" styleClass="coluna">
						#{lista.qtdLotes}
			        </p:column>
			        
					<p:column style="width:16px">
						<p:rowToggler />
					</p:column>

			        <p:rowExpansion>
			        	<br/>
			        	<p:dataTable id="tbConsulta" var="lsInt" value="#{lista.triagemLotes}" widgetVar="tabelaConsulta"
							emptyMessage="#{msgs.nenhum_dado_encontrado}" rowKey="#{lista.id}" selection="#{triagemLoteBean.triagemLote}" 
							selectionMode="single" editable="true" rowStyleClass="classROW" paginatorPosition="top">
			        	
				        	<p:ajax event="rowEdit" listener="#{triagemLoteBean.onEdit}" update=":formGeral:tabelaAgendas" />
	
							<p:column headerText="#{msgs.codigo_msg}" styleClass="coluna3">
					 			#{lsInt.id}
					        </p:column>
					
							<p:column headerText="#{msgs.data_msg}" styleClass="coluna2">
					        	<h:outputText value="#{lsInt.dataCriacaoLote}">
									<f:convertDateTime pattern="dd/MM/yyyy" type="date" />
								</h:outputText>
					        </p:column>
			
					       	<p:column headerText="#{msgs.hora_msg}" styleClass="coluna2">
			   					<h:outputText value="#{lsInt.dataCriacaoLote}">
									<f:convertDateTime pattern="HH:mm" type="time" />
								</h:outputText>
					        </p:column>
					        
					        <p:column headerText="#{msgs.marca_msg}">
					 			#{lsInt.aparelhoModelo.aparelhoMarca.nome}
					        </p:column>
					
					        <p:column headerText="#{msgs.modelo_msg}">
					 			#{lsInt.aparelhoModelo.nome}
					        </p:column>
			
					        <p:column headerText="#{msgs.qtd_msg}" sortBy="#{lsInt.quantidade}" styleClass="coluna">
					        	<p:cellEditor>
					        		<f:facet name="output">
										#{lsInt.quantidade}
					        		</f:facet>
									<f:facet name="input">  
										<p:inputText value="#{lsInt.quantidade}" style="width:100%" label="#{msgs.qtd_msg}"/>  
									</f:facet>  
					        	</p:cellEditor>
					        </p:column>
					        <p:column headerText=" " style="width:60px">  
				            	<p:rowEditor />  
				        	</p:column>
				    	</p:dataTable>
				    	<br/>
			        </p:rowExpansion>
			        
			    </p:dataTable>
			    <br/>
			    <!-- ###################### SEPARADOR ######################## -->
			    <p:dialog widgetVar="dialogoADD" id="dlgADD" header="#{msgs.atendimento_msg}" resizable="false" modal="false" maximizable="false" dynamic="true" closable="true">
					<p:outputPanel id="painelADD" style="text-align:justfy; width:100%" layout="block">
			    		<table width="100%" cellspacing="3" cellpadding="3" border="0">
							<tr>
								<td style="width: 60px; text-align: right;">
									<h:outputLabel for="modelo" value="#{msgs.modelo_msg} * :" />
								</td>
								<td>
						            <p:autoComplete 
						            		value="#{triagemLoteBean.triagemLoteNovo.aparelhoModelo}" 
						            		completeMethod="#{triagemLoteBean.buscaModelos}" 
						            		converter="conversorAparelhoModelo" 
						            		var="modeloo"
						            		itemLabel="#{modeloo.nome}"
						            		itemValue="#{modeloo}" 
						            		forceSelection="true" size="50" style="width:100px" minQueryLength="2" queryDelay="500" id="modelo" maxResults="5">
									</p:autoComplete>
								</td>
							</tr>
							<tr>
								<td style="width: 70px; text-align: right;">
									<h:outputLabel for="quantidade" value="#{msgs.quantidade_msg} * :" />
								</td>
								<td>
									<p:inputText id="quantidade" size="15" value="#{triagemLoteBean.triagemLoteNovo.quantidade}" maxlength="5" onkeyup="formatarNumero(this)" label="#{msgs.quantidade_msg}"/>
								</td>
							</tr>
							<tr>
								<td colspan="2">
									<p:commandButton value="#{msgs.msgs_salvar}" update="tabelaAgendas,painelADD" actionListener="#{triagemLoteBean.salvaLoteTriagem}" ajax="true"/>
									<p:commandButton value="fechar" oncomplete="dialogoADD.hide()"/>
								</td>
							</tr>
						</table>
			    	</p:outputPanel>
			    </p:dialog>
		    </div>
	    </h:form>
	</ui:define>
</ui:composition>
</html>